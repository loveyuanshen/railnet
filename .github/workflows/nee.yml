name: Simple Sync From Upstream

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Configure Git
        run: |
          git config user.name 'github-actions[bot]'
          git config user.email 'github-actions[bot]@users.noreply.github.com'
      
      - name: Add upstream and sync
        run: |
          echo "ðŸš€ å¼€å§‹ä»Žä¸Šæ¸¸åŒæ­¥..."
          
          # æ·»åŠ ä¸Šæ¸¸ä»“åº“
          git remote add upstream https://github.com/Spr-Aachen/Twilight.git
          
          # èŽ·å–ä¸Šæ¸¸ä»£ç 
          git fetch upstream
          
          # å¤‡ä»½è‡ªå®šä¹‰å†…å®¹
          echo "ðŸ“¦ å¤‡ä»½è‡ªå®šä¹‰å†…å®¹..."
          mkdir -p .backup
          
          if [ -d "src/content" ]; then
            cp -r src/content .backup/
            echo "âœ… å¤‡ä»½ src/content"
          fi
          
          if [ -f "twilight.config.yaml" ]; then
            cp twilight.config.yaml .backup/
            echo "âœ… å¤‡ä»½ twilight.config.yaml"
          fi
          
          if [ -f ".env" ]; then
            cp .env .backup/
            echo "âœ… å¤‡ä»½ .env"
          fi
          
          # å®Œå…¨é‡ç½®åˆ°ä¸Šæ¸¸
          echo "ðŸ”„ é‡ç½®åˆ°ä¸Šæ¸¸æœ€æ–°ç‰ˆæœ¬..."
          git reset --hard upstream/main
          
          # æ¢å¤è‡ªå®šä¹‰å†…å®¹
          echo "ðŸ”’ æ¢å¤è‡ªå®šä¹‰å†…å®¹..."
          
          if [ -d ".backup/content" ]; then
            cp -r .backup/content/* src/content/ 2>/dev/null || true
            echo "âœ… æ¢å¤ src/content"
          fi
          
          if [ -f ".backup/twilight.config.yaml" ]; then
            cp .backup/twilight.config.yaml twilight.config.yaml
            echo "âœ… æ¢å¤ twilight.config.yaml"
          fi
          
          if [ -f ".backup/.env" ]; then
            cp .backup/.env .env
            echo "âœ… æ¢å¤ .env"
          fi
          
          # æäº¤æ›´æ”¹
          echo "ðŸ“ æäº¤åŒæ­¥..."
          git add .
          git commit -m "ä»Žä¸Šæ¸¸åŒæ­¥

ä¸Šæ¸¸æäº¤: $(git rev-parse upstream/main)
åŒæ­¥æ—¶é—´: $(date)

- å®Œå…¨ä»Žä¸Šæ¸¸åŒæ­¥
- ä¿ç•™è‡ªå®šä¹‰å†…å®¹" || echo "æ²¡æœ‰æ›´æ”¹éœ€è¦æäº¤"
          
          # æŽ¨é€åˆ°è¿œç¨‹
          git push origin main
          
          echo "âœ… åŒæ­¥å®Œæˆï¼"
      
      - name: Show result
        run: |
          echo "## ðŸ“Š åŒæ­¥ç»“æžœ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… å·²ä»Žä¸Šæ¸¸å®Œå…¨åŒæ­¥" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”’ è‡ªå®šä¹‰å†…å®¹å·²ä¿æŠ¤" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“ æ‰€æœ‰æ›´æ”¹å·²æäº¤" >> $GITHUB_STEP_SUMMARY
